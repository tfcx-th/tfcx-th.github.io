<!DOCTYPE html><html lang="zh-CN"><head><meta name="generator" content="Hexo 3.8.0"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="前端小码农~"><title>ES6-Promise | 天赋创新的blog</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/normalize/8.0.1/normalize.min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//lib.baomitu.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//lib.baomitu.com/jquery/3.4.0/jquery.min.js"></script><link rel="icon" mask sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">ES6-Promise</h1><a id="logo" href="/.">天赋创新的blog</a><p class="description"></p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">ES6-Promise</h1><div class="post-meta">Jul 22, 2019<span> | </span><span class="category"><a href="/categories/前端/">前端</a></span></div><div class="clear"><div class="toc-article" id="toc"><div class="toc-title">文章目录</div><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#基本概念"><span class="toc-number">1.</span> <span class="toc-text">基本概念</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#基本用法"><span class="toc-number">2.</span> <span class="toc-text">基本用法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#实例方法"><span class="toc-number">3.</span> <span class="toc-text">实例方法</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Promise-prototype-then"><span class="toc-number">3.1.</span> <span class="toc-text">Promise.prototype.then()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Promise-prototype-catch"><span class="toc-number">3.2.</span> <span class="toc-text">Promise.prototype.catch()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Promise-prototype-finally"><span class="toc-number">3.3.</span> <span class="toc-text">Promise.prototype.finally()</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#静态方法"><span class="toc-number">4.</span> <span class="toc-text">静态方法</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Promise-all"><span class="toc-number">4.1.</span> <span class="toc-text">Promise.all()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Promise-race"><span class="toc-number">4.2.</span> <span class="toc-text">Promise.race()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Promise-resolve"><span class="toc-number">4.3.</span> <span class="toc-text">Promise.resolve()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Promise-reject"><span class="toc-number">4.4.</span> <span class="toc-text">Promise.reject()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Promise-allSettled"><span class="toc-number">4.5.</span> <span class="toc-text">Promise.allSettled()</span></a></li></ol></li></ol></div></div><div class="post-content"><h2 id="基本概念"><a href="#基本概念" class="headerlink" title="基本概念"></a>基本概念</h2><p>做异步请求时，我们往往会在请求成功的回调函数里继续写函数，或者继续发送异步，继续回调，回调函数里又回调，一层一层嵌套，就会形成回调地狱。这会使我们的代码可读性变差，不好维护，性能也下降，<code>promise</code>可以解决回调地狱的问题</p>
<p><code>Promise</code>起到代理的作用，被代理的值在<code>Promise</code>对象创建时可能是未知的。它允许你为异步操作的成功和失败分别绑定相应的处理方法，这让异步方法可以像同步方法那样返回值，但并不是立即返回最终执行结果，而是一个能代表未来出现的结果的promise对象</p>
<p><code>Promise</code>对象用于表示一个异步操作的最终状态（完成或失败），以及该异步操作的结果值</p>
<p>一个<code>Promise</code>有以下几种状态:</p>
<ul>
<li><p><code>pending</code>: 初始状态，既不是成功，也不是失败状态</p>
</li>
<li><p><code>fulfilled</code>: 意味着操作成功完成</p>
</li>
<li><p><code>rejected</code>: 意味着操作失败</p>
</li>
</ul>
<p>只有异步操作的结果可以决定当前是哪一种状态，任何其他操作都无法改变这个状态</p>
<p><code>Promise</code>对象只可能会发生两种改变：</p>
<ul>
<li><p><code>pending</code>状态变为<code>fulfilled</code>状态并传递一个值给相应的状态处理方法</p>
</li>
<li><p><code>pending</code>状态变为<code>rejected</code>并传递失败信息</p>
</li>
</ul>
<p>当其中任一种情况出现时，<code>Promise</code>对象的<code>then</code>方法绑定的处理方法就会被调用，<code>then</code>方法包含两个函数作为参数：<code>onfulfilled</code>和<code>onrejected</code></p>
<p>当<code>Promise</code>状态为<code>fulfilled</code>时，调用<code>onfulfilled</code>方法，反之调用<code>onrejected</code>方法</p>
<p><img src="/2019/07/22/ES6-Promise/promises.png" alt="ES6-Promise"></p>
<h2 id="基本用法"><a href="#基本用法" class="headerlink" title="基本用法"></a>基本用法</h2><p><code>Promise</code>对象是一个构造函数，用来生成<code>Promise</code>实例</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> promise = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// code ...</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="comment">/* success */</span>) &#123;</span><br><span class="line">    resolve(value);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    reject(error);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>可以看到，<code>Promise</code>构造函数接受一个函数作为参数，而该函数的两个参数分别为<code>resolve</code>函数和<code>reject</code>函数</p>
<ul>
<li><p>当异步操作成功，也即是从<code>pending</code>状态变为<code>fulfilled</code>状态时，调用<code>resolve</code>，并将异步操作的结果作为参数传递出去</p>
</li>
<li><p>当异步操作失败，也即是从<code>pending</code>状态变为<code>rejected</code>状态时，调用<code>reject</code>，并将异步操作的结果作为参数传递出去</p>
</li>
</ul>
<p>在<code>Promise</code>实例生成以后，可使用<code>then</code>方法分别指定<code>fulfilled</code>和<code>rejected</code>状态的回调函数</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">promise.then(<span class="function"><span class="params">value</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// success ...</span></span><br><span class="line">&#125;, error =&gt; &#123;</span><br><span class="line">  <span class="comment">// failure ...</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>来看一个例子</p>
<p><button type="button" onclick="promiseClick()">click</button><span id="promise" style="margin-left:10px"></span></p>
<script>
function promiseClick() {
  (function timeout(ms) {
    return new Promise((resolve, reject) => {
      setTimeout(resolve, ms, 'done');
    });
  })(2000).then(value => {
    // alert(value);
    window.document.getElementById('promise').innerHTML = value;
  });
}
</script>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">timeout</span>(<span class="params">ms</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    setTimeout(resolve, ms, <span class="string">'done'</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">timeout(<span class="number">2000</span>).then(<span class="function"><span class="params">value</span> =&gt;</span> &#123;</span><br><span class="line">  show(value);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p><code>timeout</code>方法返回一个<code>Promise</code>实例，表示过一段时间后执行，当<code>Promise</code>状态变为<code>fulfilled</code>时就会触发<code>then</code>绑定的回调函数</p>
<p><code>Promise</code>在新建后会立刻执行，<code>then</code>方法指定的回调函数会在当前脚本所有同步任务执行完之后才会执行</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> promise = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="number">1</span>);</span><br><span class="line">  resolve();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">promise.then(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="number">2</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="number">3</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 1</span></span><br><span class="line"><span class="comment">// 3</span></span><br><span class="line"><span class="comment">// 2</span></span><br></pre></td></tr></table></figure>
<p>当异步操作失败，调用<code>reject</code>，其参数通常是<code>Error</code>对象的实例</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">loadImageAsync</span>(<span class="params">url</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> image = <span class="keyword">new</span> Image();</span><br><span class="line">    image.onload = <span class="function"><span class="params">()</span> =&gt;</span> resolve(image);</span><br><span class="line">    image.onerror = <span class="function"><span class="params">()</span> =&gt;</span> reject(<span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">`Could not load image at <span class="subst">$&#123;url&#125;</span>`</span>));</span><br><span class="line">    image.src = url;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">loadImageAsync(<span class="string">'hello'</span>);</span><br><span class="line"><span class="comment">// Uncaught (in promise) Error: Could not load image at hello at Image.image.onerror</span></span><br></pre></td></tr></table></figure>
<p><code>Promise</code>对象也可以作为参数被传入<code>resolve</code>中</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> promise1 = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> reject(<span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'fail'</span>)), <span class="number">3000</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> promise2 = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> resolve(promise1), <span class="number">1000</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">promise2.then(<span class="function"><span class="params">result</span> =&gt;</span> <span class="built_in">console</span>.log(result))</span><br><span class="line">        .catch(<span class="function"><span class="params">error</span> =&gt;</span> <span class="built_in">console</span>.log(error));</span><br></pre></td></tr></table></figure>
<p><code>promise1</code>的状态在3秒后改变，<code>promise2</code>的状态在1秒后改变，由于<code>promise2</code>返回的是<code>promise1</code>，因此1秒后<code>promise2</code>的状态由<code>promise1</code>决定，故在两秒后触发<code>catch</code></p>
<p>调用<code>resolve</code>或者<code>reject</code>并不会终止<code>Promise</code>的执行</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  resolve(<span class="string">'hello'</span>);</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'world'</span>);</span><br><span class="line">&#125;).then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(res);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// world</span></span><br><span class="line"><span class="comment">// hello</span></span><br></pre></td></tr></table></figure>
<p>一般在<code>resolve</code>或者<code>reject</code>前加<code>return</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> resolve(<span class="string">'hello'</span>);</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'world'</span>);</span><br><span class="line">&#125;).then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(res);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// hello</span></span><br></pre></td></tr></table></figure>
<h2 id="实例方法"><a href="#实例方法" class="headerlink" title="实例方法"></a>实例方法</h2><h3 id="Promise-prototype-then"><a href="#Promise-prototype-then" class="headerlink" title="Promise.prototype.then()"></a>Promise.prototype.then()</h3><p>该方法可以为<code>Promise</code>实例添加状态改变时的回调函数</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Promise</span>.prototype.then(onFulfilled[, onRejected])</span><br><span class="line"></span><br><span class="line">promise.then(<span class="function"><span class="params">value</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// fulfilled code ...</span></span><br><span class="line">&#125;, err =&gt; &#123;</span><br><span class="line">  <span class="comment">// rejected code ...</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<ul>
<li><p><code>onFulfilled</code>: 第一个参数是<code>fulfilled</code>状态的回调函数</p>
</li>
<li><p><code>onRejected</code>: 第二个参数是<code>rejected</code>状态的回调函数，可选</p>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params">flag</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (flag) &#123;</span><br><span class="line">      resolve(<span class="string">'success'</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      reject(<span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'Error!'</span>))</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;).then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(res);</span><br><span class="line">  &#125;, err =&gt; &#123;</span><br><span class="line">    <span class="built_in">console</span>.error(err);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">f(<span class="number">0</span>)                                  <span class="comment">// =&gt; error</span></span><br><span class="line">f(<span class="number">1</span>)                                  <span class="comment">// =&gt; success</span></span><br></pre></td></tr></table></figure>
<p>当一个<code>Promise</code>成功或者失败，具体的返回值依据<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise/then#Return_value" target="_blank" rel="noopener">以下规则</a>返回：</p>
<ul>
<li><p>如果<code>then</code>中的回调函数返回一个值，那么<code>then</code>返回的<code>Promise</code>将会成为<code>fulfilled</code>状态，并且将返回的值作为<code>fulfilled</code>状态的回调函数的参数值</p>
</li>
<li><p>如果<code>then</code>中的回调函数没有返回值，那么<code>then</code>返回的<code>Promise</code>将会成为<code>fulfilled</code>状态，并且该<code>fulfilled</code>状态的回调函数的参数值为<code>undefined</code></p>
</li>
<li><p>如果<code>then</code>中的回调函数抛出一个错误，那么<code>then</code>返回的<code>Promise</code>将会成为<code>rejected</code>状态，并且将抛出的错误作为<code>rejected</code>状态的回调函数的参数值</p>
</li>
<li><p>如果<code>then</code>中的回调函数返回一个已经是<code>fulfilled</code>状态的<code>Promise</code>，那么<code>then</code>返回的<code>Promise</code>也会成为<code>fulfilled</code>状态，并且将那个<code>Promise</code>的<code>fulfilled</code>状态的回调函数的参数值作为该被返回的<code>Promise</code>的<code>fulfilled</code>状态回调函数的参数值</p>
</li>
<li><p>如果<code>then</code>中的回调函数返回一个已经是<code>rejected</code>状态的<code>Promise</code>，那么<code>then</code>返回的<code>Promise</code>也会成为<code>rejected</code>状态，并且将那个<code>Promise</code>的<code>rejected</code>状态的回调函数的参数值作为该被返回的<code>Promise</code>的<code>rejected</code>状态回调函数的参数值</p>
</li>
<li><p>如果<code>then</code>中的回调函数返回一个未定状态（pending）的<code>Promise</code>，那么<code>then</code>返回<code>Promise</code>的状态也是未定的，并且它的终态与那个<code>Promise</code>的终态相同；同时，它变为终态时调用的回调函数参数与那个<code>Promise</code>变为终态时的回调函数的参数是相同的</p>
</li>
</ul>
<p>举例来说</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> promise = <span class="built_in">Promise</span>.resolve(<span class="number">123</span>).then(<span class="function"><span class="params">value</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(value);</span><br><span class="line">  <span class="keyword">return</span> value;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(promise)</span><br><span class="line"><span class="keyword">debugger</span>;</span><br><span class="line"></span><br><span class="line">setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(promise)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Promise &#123;&lt;pending&gt;&#125;: [[PromiseStatus]]: "pending"  [[PromiseValue]]: undefined</span></span><br><span class="line"><span class="comment">// 123</span></span><br><span class="line"><span class="comment">// Promise &#123;&lt;resolved&gt;: 123&#125;: [[PromiseStatus]]: "resolved"  [[PromiseValue]]: 123</span></span><br></pre></td></tr></table></figure>
<p><code>then</code>方法返回一个新的<code>Promise</code>对象，故可以使用链式操作</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Promise</span>.resolve(<span class="string">'a'</span>).then(<span class="function"><span class="params">str</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    str += <span class="string">'b'</span>; </span><br><span class="line">    resolve(str);</span><br><span class="line">  &#125;, <span class="number">1000</span>));</span><br><span class="line">&#125;).then(<span class="function"><span class="params">str</span> =&gt;</span> &#123;</span><br><span class="line">  setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    str += <span class="string">'c'</span>;</span><br><span class="line">    <span class="built_in">console</span>.log(str);</span><br><span class="line">  &#125;, <span class="number">1000</span>);</span><br><span class="line">  <span class="keyword">return</span> str;</span><br><span class="line">&#125;).then(<span class="function"><span class="params">str</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'hello'</span>);</span><br><span class="line">  <span class="built_in">console</span>.log(str);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// hello</span></span><br><span class="line"><span class="comment">// ab</span></span><br><span class="line"><span class="comment">// abc</span></span><br></pre></td></tr></table></figure>
<h3 id="Promise-prototype-catch"><a href="#Promise-prototype-catch" class="headerlink" title="Promise.prototype.catch()"></a>Promise.prototype.catch()</h3><h3 id="Promise-prototype-finally"><a href="#Promise-prototype-finally" class="headerlink" title="Promise.prototype.finally()"></a>Promise.prototype.finally()</h3><h2 id="静态方法"><a href="#静态方法" class="headerlink" title="静态方法"></a>静态方法</h2><h3 id="Promise-all"><a href="#Promise-all" class="headerlink" title="Promise.all()"></a>Promise.all()</h3><h3 id="Promise-race"><a href="#Promise-race" class="headerlink" title="Promise.race()"></a>Promise.race()</h3><h3 id="Promise-resolve"><a href="#Promise-resolve" class="headerlink" title="Promise.resolve()"></a>Promise.resolve()</h3><h3 id="Promise-reject"><a href="#Promise-reject" class="headerlink" title="Promise.reject()"></a>Promise.reject()</h3><h3 id="Promise-allSettled"><a href="#Promise-allSettled" class="headerlink" title="Promise.allSettled()"></a>Promise.allSettled()</h3></div><div class="tags"><a href="/tags/前端/">前端</a><a href="/tags/JavaScript/">JavaScript</a><a href="/tags/ES6/">ES6</a></div><div class="post-nav"><a class="pre" href="/2019/07/26/《CSS揭秘》读书笔记（三）：视觉效果/">《CSS揭秘》读书笔记（三）：视觉效果</a><a class="next" href="/2019/07/18/Vue源码阅读——new Vue/">Vue源码阅读（二）—— new Vue</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.baidu.com/baidu" method="get" accept-charset="utf-8" target="_blank"><input type="search" name="word" maxlength="20" placeholder="Search"><input type="hidden" name="si" value="http://yoursite.com"><input name="tn" type="hidden" value="bds"><input name="cl" type="hidden" value="3"><input name="ct" type="hidden" value="2097152"><input name="s" type="hidden" value="on"></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/DevTools/">DevTools</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/JavaScript/">JavaScript</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/前端/">前端</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/可视化/">可视化</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/机器学习/">机器学习</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/测试/">测试</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/算法/">算法</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/网络/">网络</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/《Data-Visualization-with-JavaScript》/" style="font-size: 15px;">《Data Visualization with JavaScript》</a> <a href="/tags/前端/" style="font-size: 15px;">前端</a> <a href="/tags/JavaScript/" style="font-size: 15px;">JavaScript</a> <a href="/tags/ES6/" style="font-size: 15px;">ES6</a> <a href="/tags/网络/" style="font-size: 15px;">网络</a> <a href="/tags/Vue/" style="font-size: 15px;">Vue</a> <a href="/tags/前端框架/" style="font-size: 15px;">前端框架</a> <a href="/tags/算法/" style="font-size: 15px;">算法</a> <a href="/tags/可视化/" style="font-size: 15px;">可视化</a> <a href="/tags/HTML-CSS/" style="font-size: 15px;">HTML&CSS</a> <a href="/tags/动态规划/" style="font-size: 15px;">动态规划</a> <a href="/tags/测试/" style="font-size: 15px;">测试</a> <a href="/tags/软件工程思想/" style="font-size: 15px;">软件工程思想</a> <a href="/tags/DevTools/" style="font-size: 15px;">DevTools</a> <a href="/tags/git/" style="font-size: 15px;">git</a> <a href="/tags/读书笔记/" style="font-size: 15px;">读书笔记</a> <a href="/tags/《CSS揭秘》/" style="font-size: 15px;">《CSS揭秘》</a> <a href="/tags/机器学习/" style="font-size: 15px;">机器学习</a> <a href="/tags/数据结构/" style="font-size: 15px;">数据结构</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2019/09/02/JavaScript中Array常用方法/">JavaScript中Array的常用方法</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/08/29/二叉树基本操作的实现/">排序二叉树基本操作</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/08/25/Vue源码阅读——render/">Vue源码阅读（四）—— render</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/08/20/利用闭包实现函数的记忆/">利用闭包实现函数的记忆</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/08/17/《CSS揭秘》读书笔记（四）：文本/">《CSS揭秘》读书笔记（四）：文本</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/08/12/决策树/">决策树</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/08/08/Vue源码阅读——Vue实例挂载/">Vue源码阅读（三）—— Vue实例挂载</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/08/03/常见文本样式/">常见文本样式</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/07/29/BigInt/">BigInt——JavaScript超出安全整数限制时的计算</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/07/26/《CSS揭秘》读书笔记（三）：视觉效果/">《CSS揭秘》读书笔记（三）：视觉效果</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="https://github.com/tfcx-th" title="天赋创新的GitHub" target="_blank">天赋创新的GitHub</a><ul></ul><a href="mailto:tonghao_xjtu@qq.com" title="天赋创新的邮箱" target="_blank">天赋创新的邮箱</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2019 <a href="/." rel="nofollow">天赋创新的blog.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>